<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cactus.guozy.core.dao.CategoryDao">
  <resultMap id="category" type="com.cactus.guozy.core.domain.Category">
    <result column="catid" jdbcType="INTEGER" property="id" />
    <result column="catname" jdbcType="VARCHAR" property="name" />
  </resultMap>
  
  <resultMap id="goods" type="com.cactus.guozy.core.domain.Goods">
    <result column="gid" jdbcType="INTEGER" property="id" />
    <result column="gname" jdbcType="VARCHAR" property="name" />
    <result column="gprice" jdbcType="DECIMAL" property="price" />
    <result column="gneed_saler" jdbcType="BIT" property="needSaler" />
  </resultMap>
  
  <resultMap id="categoryWithGoods" type="com.cactus.guozy.core.domain.Category" extends="category">
  	<collection property="goods" resultMap="goods"/>
  </resultMap>
  
  <insert id="insert" parameterType="com.cactus.guozy.core.domain.Category">
    insert into category (id, name, sid
      )
    values (#{id,jdbcType=INTEGER}, #{name,jdbcType=VARCHAR}, #{sid,jdbcType=INTEGER}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.cactus.guozy.core.domain.Category">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Dec 30 15:54:18 CST 2016.
    -->
    insert into category
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        id,
      </if>
      <if test="name != null">
        name,
      </if>
      <if test="sid != null">
        sid,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=INTEGER},
      </if>
      <if test="name != null">
        #{name,jdbcType=VARCHAR},
      </if>
      <if test="sid != null">
        #{sid,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  <select id="readCategories" parameterType="java.lang.Long" resultMap="category">
  	SELECT id as catid, name as catname
  	FROM category
  	WHERE sid = #{shopId}
  </select>
	
  <select id="readCategoryWithGoods" parameterType="java.lang.Long" resultMap="categoryWithGoods">
		SELECT c.id as catid,c.name as catname,g.id as gid,g.name as gname,g.price as gprice,g.need_saler as gneed_saler 
		FROM category c 
			LEFT JOIN goods_cat_xref gc ON c.id = gc.cid
		    LEFT JOIN goods g ON gc.gid = g.id
		WHERE c.id = #{cid}
  </select>
  
  <insert id="addGoodsToCategory">
    INSERT INTO goods_cat_xref (gid, cid)
    VALUES (#{param1.id}, #{param2.id})
  </insert>
</mapper>